"use strict";angular.module("appSettings",[]).factory("settings",function(){var a=!1,b=function(){return a?c:"user"+Math.floor(100*Math.random()+1)},c=b();return{server:"http://185.13.90.140:8081",userName:c}}),angular.module("socket.io",["appSettings"]).factory("socket",["$rootScope","settings",function(a,b){var c=io.connect(b.server);return{on:function(b,d){c.on(b,function(){var b=arguments;a.$apply(function(){d.apply(c,b)})})},emit:function(b,d,e){c.emit(b,d,function(){var b=arguments;a.$apply(function(){e&&e.apply(c,b)})})}}}]),angular.module("phoneApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","appSettings","socket.io"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/chat.html",controller:"ChatCtrl",controllerAs:"chat"}).when("/photos",{templateUrl:"views/photos.html",controller:"PhotosCtrl",controllerAs:"photos"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl",controllerAs:"settings"}).otherwise({redirectTo:"/"})}]),angular.module("phoneApp").service("ChatService",["$filter","socket",function(a,b){this.chatLog=[],this.newMessage=function(a,c){this.chatLog.push({method:"sent",user:"",message:c}),b.emit("message",{user:a,message:c})},this.getMessages=function(c){var d={};b.on("message",function(b){d.method="received",d.user=a("extract")(b.message,"user",c),d.message=a("extract")(b.message,"message",c),d.message&&this.chatLog.push(d),d={}}.bind(this))}}]),angular.module("phoneApp").controller("ChatCtrl",["$scope","ChatService","settings",function(a,b,c){a.currentUser=c.userName,b.getMessages(a.currentUser),a.chatLog=b.chatLog,a.sendMessage=function(c){b.newMessage(a.currentUser,c)}}]),angular.module("phoneApp").controller("PhotosCtrl",function(){}),angular.module("phoneApp").controller("SettingsCtrl",function(){}),angular.module("phoneApp").directive("navbar",function(){return{restrict:"A",controller:["$scope","$element","$attrs",function(a,b){b.on("click",function(a){b.children("li").removeClass("active"),$(a.target).parent().addClass("active")})}]}}),angular.module("phoneApp").directive("blinking",function(){return{restrict:"A",scope:{getAttention:"@",linkPath:"@",linkValue:"@"},replace:!0,transclude:!0,templateUrl:"/templates/blinking.html",link:function(a,b,c,d,e){e(function(b){a.linkPath=$(b).first().attr("href"),a.linkValue=$(b).first().html()})},controller:["$scope","$element","ChatService",function(a,b,c){a.isThereANewMessage=!1,a.$watchCollection(function(){return a.chatLog},function(c){a.isThereANewMessage=!b.hasClass("active")&&c}),a.chatLog=c.chatLog}]}}),angular.module("phoneApp").directive("chatButton",function(){return{restrict:"EA",replace:!0,templateUrl:"/templates/chat-button.html",controller:["$scope",function(a){var b=$('[name="message"]');$(b).focus(),a.send=function(){event.preventDefault();var c=b.val();c&&(b.val(""),a.sendMessage(c)),$(b).focus()}}]}}),angular.module("phoneApp").directive("chatLog",function(){return{restrict:"EA",templateUrl:"/templates/chat-log.html",controller:["$scope",function(a){var b=$(".chat-area");b[0].scrollTop=b[0].scrollHeight,a.$watchCollection(function(){return a.chatLog},function(c){b[0].scrollTop=b[0].scrollHeight,a.chat=c})}]}}),angular.module("phoneApp").filter("extract",function(){return function(a,b,c){var d,e=a.indexOf("sended a message with content:"),f=function(){return e>-1?(d=a.split(" "),d[0]):""},g=function(){return e>-1?(d=a.split(" "),d.splice(0,e-1),d.join(" ")):a};return"user"===b?f()===c?"":f():"message"===b?f()===c?"":g():void 0}}),angular.module("phoneappApp").run(["$templateCache",function(a){a.put("views/chat.html",'<div> <h3>Chat area</h3> <div class="chat"> <chat-log></chat-log> </div> <div class="message"> <chat-button></chat-button> </div> </div>'),a.put("views/photos.html","<h1>Photos</h1>"),a.put("views/settings.html","<h1>Settings</h1>")}]);